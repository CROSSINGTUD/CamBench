# CamBench_Real - A Benchmark to Test Cryptographic API Misuse Detectors on Real-world Usages

[![License](https://img.shields.io/badge/License-Apache_2.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)

:star: Star us on GitHub if you like our project, plan to use it, or simply want to motivate us. 

CamBench\_Real is part of the CamBench benchmarking suite and covers usages of a wide range of JCA classes observed in popular GitHub projects.
You can use it to benchmark your own cryptographic misuse detection tool, inspect our analysis results, extend it to include further interesting usages, or adapt it to your needs. 

## Table of Content

- [Use CamBench\_Real](#use-cambench_real)
  - [Building the Projects for the Benchmark](#building-the-projects-for-the-benchmark)
  - [Description of Usages](#description-of-usages) 
  - [Evaluate with RepositoryMiner](#evaluate-with-repositoryminer)
- [Benchmark Composition](#benchmark-composition)
- [Analysis Results](#analysis-results)
- [Links](#links)
- [License](#license)

## Use CamBench\_Real

### Building the Projects for the Benchmark

CamBench\_Real covers in total 20 distinct GitHub projects that can be built with maven or gradle.
The required build system and command depend on the project itself and are defined in our meta-data. 
Therefore, the concrete build command is project dependent. 
The advantage over unifying the build system for the benchmark is that we rely on the project's defined build system.
Therefore, we hope that we or you can more easily adapt the benchmark also to newer project versions. 

To download the projects and compile, you can leverage the *RepositoryMiner* that we used for this benchmark.
In case, you want to use your own infrastructure, the build commands that we tried are:
- Maven if the file *$project_path/pom.xml* exists: `mvn clean compile -DskipTests`
- Gradle if the file *$project_path/build.gradle* exists: `gradle` or `./gradlew` (file *$project_path/gradlew*) :exclamation: ensure that `gradlew` is executable.

We include details about the respective GitHub projects in the folder [gh_data](CamBench_Real/gh_data).
Within this folder, each repository has it's own folder with the naming scheme *owner_reponame*, such as *alibaba_canal*. 
In other words, the folder is the repositorys full name where `\` is replaced with `_`.
In the repository folder, the file *github.json* includes the information about the project that we collected, such as URL, language, description, and commits. 

For CamBench\_Real we used the latest commit in our sampling time frame. 
If you want to compile the project in the same version - which is recommended - you can find the commit that we used in the file *$project_results/github.json*. 
Within the JSON-file, the latest 30 commits are listed, and the most recent one is `commits[0].sha`.

### Description of Usages

For each of the 64 randomly sampled JCA usages included in CamBench\_Real, we created a meta-data file.
This file is written in [YAML](https://yaml.org).
The structure is similar to the one of CamBench\_Cap and is an adaption to the meta-data files used in [MuBench](https://github.com/stg-tud/MUBench).
We will describe the meta-data file in more details here and the CamBench paper. 
Each meta-data file is named after a unique identifier, such as [44.yaml](CamBench_Real/usages/ant-media_Ant-Media-Server/44.yaml), that we used to distinguish different usages while manual reviewing the usages.

All usages can be found in the folder *usages*.
Within this folder, each repository has one folder in the same naming scheme as described for the folder *gh_data* in [Building the Projects for the Benchmark](#building-the-projects-for-the-benchmark).
:exclamation: Due to responsible disclosure, we currently only publish secure usages (`violation: false`). 
If you need the complete benchmark, please reach out to us via email. 


### Evaluate with RepositoryMiner

We included an evaluation platform within the *RepositoryMiner*.
This platform can be used to review if one or multiple cryptographic misuse detectors correctly identified the usages labeled as insecure.
Further, it is possible to check if for the secure usages a report was generated by any of the detectors. 
Besides labeling if a report is a true or false positive, it is possible to add comments to each report. 

## Benchmark Composition

CamBench\_Real includes usages of the JCA. 
Concretely, classes that start with `javax.security` or `java.crypto`.
The 64 usages, 33 secure and 31 inseucre usages, cover 53 distinct classes of the JCA. 

<details>
  <summary> Overview of all JCA classes included, sorted alphabatically. </summary>
  <table>
    <caption>
    JCA classes and number of usages in CamBenchREAL.
    </caption>
    <thead>
      <tr>
        <th style="text-align:left;">
          API
        </th>
        <th style="text-align:right;">
          Usages in Benchmark 
        </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="text-align:left;">
          java.security.AccessController
        </td>
        <td style="text-align:right;">
          1
        </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.DigestOutputStream
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.Key
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.KeyFactory
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.KeyPair
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.KeyPairGenerator
      </td>
      <td style="text-align:right;">
      2
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.KeyStore
      </td>
      <td style="text-align:right;">
      3
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.KeyStore$PasswordProtection </td>  <td style="text-align:right;"> 1 </td>  </tr>  <tr>  <td style="text-align:left;"> java.security.KeyStore$PrivateKeyEntry
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.MessageDigest
      </td>
      <td style="text-align:right;">
      2
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.Permission
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.Permissions
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.Policy
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.Principal
      </td>
      <td style="text-align:right;">
      2
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.PrivateKey
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.ProtectionDomain
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.PublicKey
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.SecureRandom
      </td>
      <td style="text-align:right;">
      2
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.Security
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.Signature
      </td>
      <td style="text-align:right;">
      3
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.cert.CertPathValidator
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.cert.CertStore
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.cert.Certificate
      </td>
      <td style="text-align:right;">
      2
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.cert.CertificateFactory
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.cert.CollectionCertStoreParameters
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.cert.PKIXBuilderParameters
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.cert.PKIXParameters
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.cert.TrustAnchor
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.cert.X509CertSelector
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.cert.X509Certificate
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.interfaces.DSAParams
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.interfaces.ECPrivateKey
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.interfaces.ECPublicKey
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.interfaces.RSAPublicKey
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.spec.ECParameterSpec
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.spec.ECPoint
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.spec.EllipticCurve
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.spec.PKCS8EncodedKeySpec
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.spec.RSAPrivateCrtKeySpec
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      java.security.spec.X509EncodedKeySpec
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      javax.crypto.Cipher
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      javax.crypto.CipherInputStream
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      javax.crypto.EncryptedPrivateKeyInfo
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      javax.crypto.KeyAgreement
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      javax.crypto.KeyGenerator
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      javax.crypto.Mac
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      javax.crypto.SecretKey
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      javax.crypto.SecretKeyFactory
      </td>
      <td style="text-align:right;">
      2
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      javax.crypto.interfaces.DHPublicKey
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      javax.crypto.spec.DESKeySpec
      </td>
      <td style="text-align:right;">
      2
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      javax.crypto.spec.IvParameterSpec
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      javax.crypto.spec.PBEKeySpec
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
      <tr>
      <td style="text-align:left;">
      javax.crypto.spec.SecretKeySpec
      </td>
      <td style="text-align:right;">
      1
      </td>
      </tr>
    </tbody>
  </table>

</details>

The 64 usages of the JCA are included over 20 different projects. 
Each project has on median 2.5 usages and on mean 3.2 usages.
The maximum number of usages for one project is 10. 

## Analysis Results

We used CamBench\_Real to evaluate four different cryptographic misuse detectors, namely CogniCrypt, CryptoGuard, FindSecBugs, and SonarQube.
While CogniCrypt and CryptoGuard are specifically built to detect cryptographic misuses, FindSecBugs and SonarQube are static analyses that cover a wide range of misuses.  
For the 31 secure usages, we did not receive one report of any of the tools. 
For the 33 secure usages, all tools together detected misuses for 15 different usages.
We present the results in the Table below.

| **ID** | **CogniCrypt**  | **CryptoGuard**|  **FindSecBugs** |   **SonarQube** |  
|------------------------------------------------|---------------------------------|----------------------------|----------------------------|----------------------------|
| *Insecure Key* | | | |
| 68-1 |  :heavy_check_mark: |  :x: | :x: | :heavy_check_mark: |  
| 129 | :heavy_check_mark:   |  :heavy_check_mark:  | :x: |  :x: | 
| 129-1  | :x:  |  :heavy_check_mark:  | :x: | :x: | 
| 148 | :heavy_check_mark:  | :heavy_check_mark: | :x: | :x: | 
| *Encryption Algorithm* | | | |
| 68 | :heavy_check_mark:  |   :heavy_check_mark:  |  :x:  | :x: | 
| 146 | :x: | :heavy_check_mark: | :heavy_check_mark: | :heavy_check_mark:          |
| *Insecure Initialization Vector* | | | |
| 71-1 | :heavy_check_mark:   |  :x:  |  :x: | :heavy_check_mark:          | 
| *Insecure Message Digest* | | | | 
| 34-2 | :heavy_check_mark:  |  :heavy_check_mark:  | :heavy_check_mark:  | :x: | 
| **Total subset (8)** | 6 | 6 | 2 | 3 |
| *Insecure Mac Algorithm* | | | | 
| 110 | :heavy_check_mark: |  :x: |  :x: |  :x: |
| *Insecure Password-based Encryption* | | | |
| 72 | :heavy_check_mark: | :x: | :x: | :x: | 
| *Insecure Signature Algorithm* | | | | 
| 45 | :heavy_check_mark: | :x: | :x: | :x: |
| *Usage of String for Sensitive Information* | | | | 
| 33 | :heavy_check_mark: | :x: | :x: | :x: | 
| 45-1 | :heavy_check_mark: | :x: |: x: | :x: | 
| 99 | :heavy_check_mark: | :x: | :x: | :x: |
| 151 | :heavy_check_mark: | :x: | :x: | :x: |
| **Total all (15)** |13 | 6 | 2 | 3 | 

## Links

- Definition of ground truth for security: [Federal Office for Information Security (BSI)](./BSI_Technical_Guideline.md)

## License

CamBench\_Real is licensed under the terms of [Apache License Version 2.0, January 2004](LICENSE).
